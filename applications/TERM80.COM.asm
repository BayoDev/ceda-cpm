; This is the disassembly of the "TERM80.COM" program for the Sanco 8003
; found in the CP/M 2.2 image at this link:
;       https://archive.org/details/sanco-8003-cpm-2.2fr.dsqd
;
; By Giulio Venturini (@BayoDev)
;
; THIS IS NOT COMPLETE, MANY PARTS OF THE CODE REMAIN UNEXPLAINED AND SOME UNREACHABLE
    
    
    org $0100
    
CPM_ENTRY:
    jp      ENTRY_POINT                     ;[0100]
    
    rst     $38                             ;[0103]
    nop                                     ;[0104]
    nop                                     ;[0105]
    ld      sp,$3239                        ;[0106]
    jr      nc,$013b                        ;[0109]
    jr      nc,$013f                        ;[010b]
    ld      sp,$2c30                        ;[010d]
    ld      d,e                             ;[0110]
    ld      b,c                             ;[0111]
    ld      c,(hl)                          ;[0112]
    ld      b,e                             ;[0113]
    ld      c,a                             ;[0114]
    dec     c                               ;[0115]
    
    DB $b1                                  ;[0116] Serial port device number (CONTROL)
    DB $01                                  ;[0117] Bit mask for SIO's RR0 "Receive Character Available"
    DB $04                                  ;[0118] Bit mask for SIO's RR0 "Transmit Buffer Empty" (bit set=empty buffer)
    DB $b0                                  ;[0119] Serial port device number (DATA)
    
    inc     h                               ;[011a]
    ld      bc,$0010                        ;[011b]
    nop                                     ;[011e]
    nop                                     ;[011f]
    nop                                     ;[0120]
    nop                                     ;[0121]
    nop                                     ;[0122]
    nop                                     ;[0123]
    nop                                     ;[0124]
    nop                                     ;[0125]
    nop                                     ;[0126]
    nop                                     ;[0127]
    nop                                     ;[0128]
    nop                                     ;[0129]
    nop                                     ;[012a]
    nop                                     ;[012b]
    nop                                     ;[012c]
    nop                                     ;[012d]
    nop                                     ;[012e]
    nop                                     ;[012f]
    nop                                     ;[0130]
    inc     h                               ;[0131]
    dec     d                               ;[0132]
    ld      e,$19                           ;[0133]
    nop                                     ;[0135]
    jr      $0138                           ;[0136]
    rla                                     ;[0138]
    ld      a,(de)                          ;[0139]
    nop                                     ;[013a]
    nop                                     ;[013b]
    nop                                     ;[013c]
    nop                                     ;[013d]
    nop                                     ;[013e]
    nop                                     ;[013f]
    nop                                     ;[0140]
    nop                                     ;[0141]
    nop                                     ;[0142]
    nop                                     ;[0143]
    nop                                     ;[0144]
    nop                                     ;[0145]
    inc     h                               ;[0146]
    nop                                     ;[0147]
    nop                                     ;[0148]
    nop                                     ;[0149]
    nop                                     ;[014a]
    nop                                     ;[014b]
    nop                                     ;[014c]
    nop                                     ;[014d]
    nop                                     ;[014e]
    nop                                     ;[014f]
    nop                                     ;[0150]
    nop                                     ;[0151]
    nop                                     ;[0152]
    nop                                     ;[0153]
    nop                                     ;[0154]
    nop                                     ;[0155]
    nop                                     ;[0156]
    nop                                     ;[0157]
    nop                                     ;[0158]
    nop                                     ;[0159]
    nop                                     ;[015a]
    nop                                     ;[015b]
    nop                                     ;[015c]
    nop                                     ;[015d]
    nop                                     ;[015e]
    nop                                     ;[015f]
    
    DB $00                                  ;[0160] Printer echo activation ($00=Disabled,otherwise enabled)
    DB $00                                  ;[0161]
    DB $CD                                  ;[0162]
    DB $00                                  ;[0163]
    DB $00                                  ;[0164]
    
    nop                                     ;[0165]
    nop                                     ;[0166]
    nop                                     ;[0167]
    nop                                     ;[0168]
    nop                                     ;[0169]
    nop                                     ;[016a]
    nop                                     ;[016b]
    nop                                     ;[016c]
    nop                                     ;[016d]
    nop                                     ;[016e]
    nop                                     ;[016f]
    nop                                     ;[0170]
    nop                                     ;[0171]
    nop                                     ;[0172]
    nop                                     ;[0173]
    nop                                     ;[0174]
    nop                                     ;[0175]
    nop                                     ;[0176]
    nop                                     ;[0177]
    nop                                     ;[0178]
    nop                                     ;[0179]
    nop                                     ;[017a]
    nop                                     ;[017b]
    nop                                     ;[017c]
    nop                                     ;[017d]
    nop                                     ;[017e]
    nop                                     ;[017f]
    nop                                     ;[0180]
    nop                                     ;[0181]
    nop                                     ;[0182]
    nop                                     ;[0183]
    nop                                     ;[0184]
    nop                                     ;[0185]
    nop                                     ;[0186]
    nop                                     ;[0187]
    nop                                     ;[0188]
    nop                                     ;[0189]
    nop                                     ;[018a]
    nop                                     ;[018b]
    nop                                     ;[018c]
    nop                                     ;[018d]
    nop                                     ;[018e]
    nop                                     ;[018f]
    nop                                     ;[0190]
    nop                                     ;[0191]
    nop                                     ;[0192]
    nop                                     ;[0193]
    nop                                     ;[0194]
    nop                                     ;[0195]
    nop                                     ;[0196]
    nop                                     ;[0197]
    nop                                     ;[0198]
    nop                                     ;[0199]
    nop                                     ;[019a]
    nop                                     ;[019b]
    nop                                     ;[019c]
    nop                                     ;[019d]
    nop                                     ;[019e]
    nop                                     ;[019f]
    nop                                     ;[01a0]
    nop                                     ;[01a1]
    nop                                     ;[01a2]
    nop                                     ;[01a3]
    nop                                     ;[01a4]
    nop                                     ;[01a5]
    nop                                     ;[01a6]
    nop                                     ;[01a7]
    nop                                     ;[01a8]
    nop                                     ;[01a9]
    nop                                     ;[01aa]
    nop                                     ;[01ab]
    nop                                     ;[01ac]
    nop                                     ;[01ad]
    nop                                     ;[01ae]
    nop                                     ;[01af]
    nop                                     ;[01b0]
    nop                                     ;[01b1]
    nop                                     ;[01b2]
    nop                                     ;[01b3]
    nop                                     ;[01b4]
    nop                                     ;[01b5]
    nop                                     ;[01b6]
    nop                                     ;[01b7]
    nop                                     ;[01b8]
    nop                                     ;[01b9]
    nop                                     ;[01ba]
    nop                                     ;[01bb]
    nop                                     ;[01bc]
    nop                                     ;[01bd]
    nop                                     ;[01be]
    nop                                     ;[01bf]
    nop                                     ;[01c0]
    nop                                     ;[01c1]
    nop                                     ;[01c2]
    nop                                     ;[01c3]
    nop                                     ;[01c4]
    nop                                     ;[01c5]
    
; A = {$FF = console device ready, $00 otherwise}
CONSOLE_READY:
    jp      $01c6                           ;[01c6] After SETUP routine jumps to CONST BIOS entry
    
; A = console character ; Wait until the character is ready
CONSOLE_INPUT:
    jp      $01c9                           ;[01c9] After SETUP routine jumps to CONIN BIOS entry
    
;The character is sent from register C to the console output device. The character is in ASCII, with high-order parity bit set to zero.
CONSOLE_OUTPUT:
    jp      $01cc                           ;[01cc] After SETUP routine jumps to CONOUT BIOS entry
    
; You return the ready status of the list device used by the DESPOOL program to improve console response during its operation.
; The value 00 is returned in A if the list device is not ready to accept a character and 0FFH if a character can be sent to the printer.
; A 00 value should be returned if LIST status is not implemented.
LIST_STATUS:
    jp      $01cf                           ;[01cf] After SETUP routine jumps to WRITE BIOS entry
    
ENTRY_POINT:
    ld      sp,$0820                        ;[01d2]
    call    SETUP_WRAPPER                   ;[01d5]
    jp      STARTUP                         ;[01d8]
    
    call    SERIAL_READY_SIGNAL             ;[01db]
    call    SERIAL_NOT_READY_SIGNAL         ;[01de]
    call    CONSOLE_INPUT                   ;[01e1]
    call    $027f                           ;[01e4]
    
    cp      $04                             ;[01e7]
    jp      z,ENTRY_POINT                   ;[01e9]
    cp      $14                             ;[01ec]
    jp      z,STARTUP                       ;[01ee]
    cp      $0c                             ;[01f1]
    jp      z,$03ba                         ;[01f3]
    cp      $17                             ;[01f6]
    jp      z,$03ab                         ;[01f8]
    cp      $03                             ;[01fb]
    jp      z,$037a                         ;[01fd]
    cp      $01                             ;[0200]
    jp      z,$0961                         ;[0202]
    cp      $0d                             ;[0205]
    jp      z,$0898                         ;[0207]
    jp      $01db                           ;[020a]
    
STARTUP:
    ld      de,INIT_STRING                  ;[020d]
    call    C_WRITESTR                      ;[0210] Write initial string
MAIN_LOOP:
    call    SERIAL_READY_SIGNAL             ;[0213] Setup SIO ready for data
    call    SERIAL_IN_AVAIL                 ;[0216] Check if there is a character to read from the SIO
    jp      nz,GET_INPUT                    ;[0219] Jump if a character is ready to be read from the SIO
    call    SERIAL_NOT_READY_SIGNAL         ;[021c] Setup SIO not ready for data
    call    CONSOLE_READY                   ;[021f] Check TTY status
    or      a                               ;[0222]
    jp      z,MAIN_LOOP                     ;[0223] Jump if there is no character to read
    call    CONSOLE_INPUT                   ;[0226] Get character from TTY
    call    SERIAL_OUT                      ;[0229] Send character through serial
    jp      MAIN_LOOP                       ;[022c]
    
GET_INPUT:
    call    SERIAL_IN                       ;[022f] A = serial in
    cp      $12                             ;[0232]
    jr      nz,PROCESS_ASCII                ;[0234] Jump if A!=$12 (DC2) (Could be used to indicate activation of communication)
; Assuming $0161 is not modified elsewhere the first time that $12 is received
; it wont call ACTIVATE_PRINTER, but then it wil for the next 255 times that $12 is received (?)
    ld      a,($0161)                       ;[0236]
    or      a                               ;[0239]
    jr      nz,ACTIVATE_PRINTER             ;[023a] Jump if ($0161)!=0
    dec     a                               ;[023c]
    ld      ($0161),a                       ;[023d] ($0161) = $FF ($0-$1=$FF (?))
    xor     a                               ;[0240] A = $00
    call    SERIAL_OUT                      ;[0241]
    jp      MAIN_LOOP                       ;[0244]
    
ACTIVATE_PRINTER:
    ld      a,$01                           ;[0247]
    ld      ($0160),a                       ;[0249] Activate printer (i.e. ($0160)=$01)
    jp      MAIN_LOOP                       ;[024c]
    
    
; Process the input ascii character (in register A) and prints it in the CRT (and printer if set)
PROCESS_ASCII:
    cp      $07                             ;[024f]
    jp      c,MAIN_LOOP                     ;[0251] $00<=A<$07 ==> Not printable
    cp      $0e                             ;[0254]
    jp      c,VALID_ASCII                   ;[0256] $07<=A<$0e ==> Valid (Cursor controls i.e. tab, line feed, etc.)
    cp      $1a                             ;[0259]
    jp      c,MAIN_LOOP                     ;[025b] $0e<=A<$1a ==> Not printable
VALID_ASCII:
    ld      c,a                             ;[025e] The value of A can only be an ascii between ($07<=A<$0e) U ($A1<=A)
    ld      a,($0160)                       ;[025f]
    or      a                               ;[0262]
    jr      nz,LINE_DEVICE_WRITE            ;[0263] Jump if ($0160)!=0 (i.e. Jump if printer is enabled)
    ld      e,c                             ;[0265]
    call    C_OUT                           ;[0266] Output character to CRT
    jp      MAIN_LOOP                       ;[0269]
    
    
; Output character stored in C to the LINE device (printer) and returns to main loop
LINE_DEVICE_WRITE:
    ld      e,c                             ;[026c]
    ld      c,$05                           ;[026d]
    call    SYSCALL                         ;[026f]
    xor     a                               ;[0272]
    ld      ($0160),a                       ;[0273] Disable printer again (???)
    call    SERIAL_OUT                      ;[0276]
    jp      MAIN_LOOP                       ;[0279]
    
    DB $00                                  ;[027c] Is set to $10BF by the SETUP routine
    DB $00                                  ;[027d]
    DB $00                                  ;[027e]
    ret                                     ;[027f]
    
    cp      $61                             ;[0280]
    ret     c                               ;[0282]
    cp      $7b                             ;[0283]
    ret     nc                              ;[0285]
    and     $5f                             ;[0286]
    ret                                     ;[0288]
    
    nop                                     ;[0289]
    ld      c,a                             ;[028a]
    ld      a,(hl)                          ;[028b]
    inc     hl                              ;[028c]
    cp      $24                             ;[028d]
    jr      z,$0299                         ;[028f]
    cp      c                               ;[0291]
    jr      z,$0297                         ;[0292]
    inc     hl                              ;[0294]
    jr      $028b                           ;[0295]
    ld      a,(hl)                          ;[0297]
    ret                                     ;[0298]
    
    ld      a,c                             ;[0299]
    ret                                     ;[029a]
    
    ld      hl,$0147                        ;[029b]
    ld      a,(hl)                          ;[029e]
    inc     hl                              ;[029f]
    or      a                               ;[02a0]
    jr      z,$02a9                         ;[02a1]
    cp      c                               ;[02a3]
    jr      z,$02a9                         ;[02a4]
    inc     hl                              ;[02a6]
    jr      $029e                           ;[02a7]
    ld      a,(hl)                          ;[02a9]
    ld      c,a                             ;[02aa]
    xor     a                               ;[02ab]
    ld      ($027e),a                       ;[02ac]
    ret                                     ;[02af]
    
SETUP_WRAPPER:
    jp      SETUP                           ;[02b0]
    
    ld      a,($0103)                       ;[02b3]
    or      a                               ;[02b6]
    jr      nz,$02c1                        ;[02b7]
    ld      de,$0cf3                        ;[02b9]
    call    C_WRITESTR                      ;[02bc]
    jr      $02c7                           ;[02bf]
    ld      de,$0cda                        ;[02c1]
    call    C_WRITESTR                      ;[02c4]
    ld      a,($0104)                       ;[02c7]
    or      a                               ;[02ca]
    jr      nz,$02d6                        ;[02cb]
    ld      de,$0d23                        ;[02cd]
    call    C_WRITESTR                      ;[02d0]
    jp      $0344                           ;[02d3]
    ld      de,$0d0c                        ;[02d6]
    call    C_WRITESTR                      ;[02d9]
    jp      $0351                           ;[02dc]
    
SETUP:
    ld      hl,($0001)                      ;[02df]
    ld      de,$0003                        ;[02e2]
    add     hl,de                           ;[02e5]
    ld      ($01c7),hl                      ;[02e6] ($01C7) = ($0001) + $0003 (CONST)
    add     hl,de                           ;[02e9]
    ld      ($01ca),hl                      ;[02ea] ($01CA) = ($0001) + $0006 (CONIN)
    add     hl,de                           ;[02ed]
    ld      ($01cd),hl                      ;[02ee] ($01CD) = ($0001) + $0009 (CONOUT)
    ld      de,$0021                        ;[02f1]
    add     hl,de                           ;[02f4]
    ld      ($01d0),hl                      ;[02f5] ($10D0) = ($0001) + $002A (LISTST)
    ld      a,$80                           ;[02f8]
    ld      hl,$0003                        ;[02fa]
    ld      (hl),a                          ;[02fd] ($0003) = $80 (Setting IOBYTE, virtual addressing CONSOLE=TTY, READER=TTY, PUNCH=TTY, LIST=LINE PRINTER DEVICE)
    ld      hl,$10bf                        ;[02fe]
    ld      ($027c),hl                      ;[0301] ($027C) = $10BF
    call    L0A9D                           ;[0304]
    ld      hl,($0ae7)                      ;[0307] Load the results from the routine call in HL
    ld      a,l                             ;[030a]
    cp      $ea                             ;[030b]
    jr      nz,L0371                        ;[030d] if (l.s.b. ($0AE7))!=$EA then jump
    ld      a,h                             ;[030f]
    cp      $49                             ;[0310]
    jr      nz,L0371                        ;[0312] if (m.s.b. ($0AE7))!=$49 then jump
SIO_SETUP:
    ld      a,$18                           ;[0314]
    out     ($b1),a                         ;[0316] Channel reset
    ld      a,$05                           ;[0318]
    out     ($b1),a                         ;[031a] Access SIO register 5
    ld      a,$ea                           ;[031c]
    out     ($b1),a                         ;[031e] Transmit enable, 8 bits character, Data terminal ready (DTR=LOW), Request to send (RTS=LOW)
    ld      a,$03                           ;[0320]
    out     ($b1),a                         ;[0322] Access SIO register 3
    ld      a,$c1                           ;[0324]
    out     ($b1),a                         ;[0326] Receive enable, 8 bits character
    ret                                     ;[0328]
    
; Activates Data terminal ready (DTR=LOW) and Request to send (RTS=LOW)
SERIAL_READY_SIGNAL:
    ld      a,$10                           ;[0329]
    out     ($b1),a                         ;[032b] Reset Ext/Status Interrupts
    ld      a,$05                           ;[032d]
    out     ($b1),a                         ;[032f] Access SIO register 5
    ld      a,$ea                           ;[0331]
    out     ($b1),a                         ;[0333] Transmit enable, 8 bits character, Data terminal ready (DTR=LOW), Request to send (RTS=LOW)
    ret                                     ;[0335]
    
; Deactivates Data terminal ready (DTR=LOW) and Request to send (RTS=LOW)
SERIAL_NOT_READY_SIGNAL:
    ld      a,$10                           ;[0336]
    ld      ($00b1),a                       ;[0338] Reset Ext/Status Interrupts
    ld      a,$05                           ;[033b]
    out     ($b1),a                         ;[033d] Access SIO register 5
    ld      a,$68                           ;[033f]
    out     ($b1),a                         ;[0341] Transmit enable, 8 bits character
    ret                                     ;[0343]
    
    ld      a,$13                           ;[0344]
    ld      ($036d),a                       ;[0346]
    ld      a,$11                           ;[0349]
    ld      ($036e),a                       ;[034b]
    jp      SETUP                           ;[034e]
    ld      a,$13                           ;[0351]
    ld      ($036d),a                       ;[0353]
    ld      a,$11                           ;[0356]
    ld      ($036e),a                       ;[0358]
    ld      a,$01                           ;[035b]
    ld      ($0104),a                       ;[035d]
    ld      a,$10                           ;[0360]
    ld      ($036f),a                       ;[0362]
    ld      a,$0d                           ;[0365]
    ld      ($0370),a                       ;[0367]
    jp      SETUP                           ;[036a]
    
    nop                                     ;[036d]
    nop                                     ;[036e]
    nop                                     ;[036f]
    
    
    DB $00                                  ;[0370]
    
L0371:
    jp      SIO_SETUP                       ;[0371]
    
    ld      a,$76                           ;[0374]
    ld      hl,$037a                        ;[0376]
    ld      (hl),a                          ;[0379]
    jp      $0000                           ;[037a]
    ld      a,($0104)                       ;[037d]
    or      a                               ;[0380]
    ret     z                               ;[0381]
    call    $0725                           ;[0382]
    ld      hl,$04cf                        ;[0385]
    call    $048e                           ;[0388]
    call    $03a1                           ;[038b]
    ret                                     ;[038e]
    
    ld      a,($0104)                       ;[038f]
    or      a                               ;[0392]
    ret     z                               ;[0393]
    call    $0725                           ;[0394]
    ld      hl,$04e0                        ;[0397]
    call    $048e                           ;[039a]
    call    $03a1                           ;[039d]
    ret                                     ;[03a0]
    
    ld      b,$03                           ;[03a1]
    call    SERIAL_IN                       ;[03a3]
    djnz    $03a3                           ;[03a6]
    ret                                     ;[03a8]
    
    and     $7f                             ;[03a9]
    call    $03cc                           ;[03ab]
    ld      de,$0b5e                        ;[03ae]
    call    C_WRITESTR                      ;[03b1]
    call    $0404                           ;[03b4]
    jp      $05fc                           ;[03b7]
    call    $037d                           ;[03ba]
    call    $03cc                           ;[03bd]
    ld      de,$0b28                        ;[03c0]
    call    C_WRITESTR                      ;[03c3]
    call    $0404                           ;[03c6]
    jp      $0529                           ;[03c9]
    xor     a                               ;[03cc]
    ld      ($03f7),a                       ;[03cd]
    ld      de,$0b43                        ;[03d0]
    call    C_WRITESTR                      ;[03d3]
    call    CONSOLE_INPUT                   ;[03d6]
    call    $027f                           ;[03d9]
    ld      e,a                             ;[03dc]
    call    C_OUT                           ;[03dd]
    ld      a,e                             ;[03e0]
    cp      $4f                             ;[03e1]
    jp      nz,$03f8                        ;[03e3]
    ld      hl,$03a9                        ;[03e6]
    ld      de,$0662                        ;[03e9]
    ld      bc,$0002                        ;[03ec]
    ldir                                    ;[03ef]
    ld      a,$01                           ;[03f1]
    ld      ($03f7),a                       ;[03f3]
    ret                                     ;[03f6]
    
    nop                                     ;[03f7]
    cp      $4e                             ;[03f8]
    jp      nz,$03cc                        ;[03fa]
    ld      hl,$0000                        ;[03fd]
    ld      ($0662),hl                      ;[0400]
    ret                                     ;[0403]
    
    ld      de,$0b79                        ;[0404]
    call    C_WRITESTR                      ;[0407]
    call    CONSOLE_INPUT                   ;[040a]
    call    $027f                           ;[040d]
    cp      $0d                             ;[0410]
    jp      nz,$0419                        ;[0412]
    xor     a                               ;[0415]
    jp      $0426                           ;[0416]
    cp      $41                             ;[0419]
    jp      c,$040a                         ;[041b]
    cp      $44                             ;[041e]
    jp      nc,$040a                        ;[0420]
    ld      e,a                             ;[0423]
    sub     $40                             ;[0424]
    ld      ($0756),a                       ;[0426]
    call    C_OUT                           ;[0429]
    call    $073f                           ;[042c]
    ld      de,$0b96                        ;[042f]
    call    C_WRITESTR                      ;[0432]
    ld      hl,$0757                        ;[0435]
    push    hl                              ;[0438]
    call    CONSOLE_INPUT                   ;[0439]
    call    $027f                           ;[043c]
    pop     hl                              ;[043f]
    cp      $04                             ;[0440]
    jp      z,ENTRY_POINT                   ;[0442]
    cp      $2e                             ;[0445]
    jp      z,$046e                         ;[0447]
    cp      $08                             ;[044a]
    call    z,$047a                         ;[044c]
    cp      $7f                             ;[044f]
    call    z,$047a                         ;[0451]
    cp      $0d                             ;[0454]
    jp      z,$0481                         ;[0456]
    push    af                              ;[0459]
    ld      e,a                             ;[045a]
    call    C_OUT                           ;[045b]
    pop     af                              ;[045e]
    cp      $08                             ;[045f]
    jp      z,$0438                         ;[0461]
    cp      $7f                             ;[0464]
    jp      z,$0438                         ;[0466]
    ld      (hl),a                          ;[0469]
    inc     hl                              ;[046a]
    jp      $0438                           ;[046b]
    push    af                              ;[046e]
    ld      e,a                             ;[046f]
    call    C_OUT                           ;[0470]
    pop     af                              ;[0473]
    ld      hl,$075f                        ;[0474]
    jp      $0438                           ;[0477]
    dec     hl                              ;[047a]
    push    af                              ;[047b]
    ld      a,$20                           ;[047c]
    ld      (hl),a                          ;[047e]
    pop     af                              ;[047f]
    ret                                     ;[0480]
    
    ld      hl,$0757                        ;[0481]
    ld      a,(hl)                          ;[0484]
    cp      $20                             ;[0485]
    jp      z,$0736                         ;[0487]
    call    $0725                           ;[048a]
    ret                                     ;[048d]
    
    ld      a,(hl)                          ;[048e]
    call    SERIAL_OUT                      ;[048f]
    cp      $10                             ;[0492]
    jr      nz,$049b                        ;[0494]
    push    hl                              ;[0496]
    call    $04b1                           ;[0497]
    pop     hl                              ;[049a]
    ld      e,a                             ;[049b]
    call    C_OUT                           ;[049c]
    ld      a,e                             ;[049f]
    cp      $0d                             ;[04a0]
    ret     z                               ;[04a2]
    or      a                               ;[04a3]
    ret     z                               ;[04a4]
    ld      bc,$ffff                        ;[04a5]
    dec     bc                              ;[04a8]
    ld      a,b                             ;[04a9]
    or      a                               ;[04aa]
    jr      nz,$04a8                        ;[04ab]
    inc     hl                              ;[04ad]
    jp      $048e                           ;[04ae]
    ld      hl,$04c0                        ;[04b1]
    ld      e,(hl)                          ;[04b4]
    call    C_OUT                           ;[04b5]
    inc     hl                              ;[04b8]
    ld      a,e                             ;[04b9]
    or      a                               ;[04ba]
    ld      a,$20                           ;[04bb]
    ret     z                               ;[04bd]
    jr      $04b4                           ;[04be]
    ld      b,e                             ;[04c0]
    ld      d,h                             ;[04c1]
    ld      d,d                             ;[04c2]
    ld      c,h                             ;[04c3]
    dec     l                               ;[04c4]
    ld      d,b                             ;[04c5]
    jr      nz,$04c8                        ;[04c6]
    ld      d,e                             ;[04c8]
    ld      d,b                             ;[04c9]
    ld      b,l                             ;[04ca]
    ld      b,c                             ;[04cb]
    ld      c,e                             ;[04cc]
    ld      hl,$1000                        ;[04cd]
    ld      d,e                             ;[04d0]
    ld      b,l                             ;[04d1]
    ld      d,h                             ;[04d2]
    ld      ($303a),a                       ;[04d3]
    inc     l                               ;[04d6]
    dec     (hl)                            ;[04d7]
    ld      a,($2c30)                       ;[04d8]
    add     hl,sp                           ;[04db]
    ld      a,($0d30)                       ;[04dc]
    nop                                     ;[04df]
    djnz    $0535                           ;[04e0]
    ld      b,l                             ;[04e2]
    ld      d,h                             ;[04e3]
    ld      ($313a),a                       ;[04e4]
    inc     l                               ;[04e7]
    dec     (hl)                            ;[04e8]
    ld      a,($0d31)                       ;[04e9]
    nop                                     ;[04ec]
    call    CONSOLE_READY                   ;[04ed]
    or      a                               ;[04f0]
    ret     z                               ;[04f1]
    call    CONSOLE_INPUT                   ;[04f2]
    call    $027f                           ;[04f5]
    ret                                     ;[04f8]
    
    ld      d,h                             ;[04f9]
    ld      d,d                             ;[04fa]
    ld      b,c                             ;[04fb]
    dec     c                               ;[04fc]
    nop                                     ;[04fd]
    call    $0725                           ;[04fe]
    ld      hl,$04f9                        ;[0501]
    call    $048e                           ;[0504]
    call    $04ed                           ;[0507]
    cp      $04                             ;[050a]
    jp      z,ENTRY_POINT                   ;[050c]
    call    SERIAL_IN_AVAIL                 ;[050f]
    jp      z,$0507                         ;[0512]
    call    SERIAL_IN                       ;[0515]
    and     $7f                             ;[0518]
    push    af                              ;[051a]
    ld      e,a                             ;[051b]
    call    C_OUT                           ;[051c]
    pop     af                              ;[051f]
    cp      $05                             ;[0520]
    jp      nz,$0507                        ;[0522]
    call    $03a1                           ;[0525]
    ret                                     ;[0528]
    
    call    L082A                           ;[0529]
    cp      $ff                             ;[052c]
    ld      de,$0ba9                        ;[052e]
    jp      z,$0730                         ;[0531]
    call    CONSOLE_INPUT                   ;[0534]
    cp      $0d                             ;[0537]
    jr      z,$0548                         ;[0539]
    call    SERIAL_OUT                      ;[053b]
    call    SERIAL_IN                       ;[053e]
    and     $7f                             ;[0541]
    call    C_OUT                           ;[0543]
    jr      $0534                           ;[0546]
    call    $04ed                           ;[0548]
    cp      $13                             ;[054b]
    jp      z,ENTRY_POINT                   ;[054d]
    call    SERIAL_IN                       ;[0550]
    and     $7f                             ;[0553]
    ld      c,a                             ;[0555]
    ld      hl,$015b                        ;[0556]
    ld      a,(hl)                          ;[0559]
    or      a                               ;[055a]
    jr      z,$0560                         ;[055b]
    cp      c                               ;[055d]
    jr      nz,$0548                        ;[055e]
    ld      a,c                             ;[0560]
    cp      $0d                             ;[0561]
    jr      nz,$0548                        ;[0563]
    call    $0704                           ;[0565]
    ld      hl,$0080                        ;[0568]
    ld      c,$14                           ;[056b]
    ld      de,$0756                        ;[056d]
    call    SYSCALL                         ;[0570]
    or      a                               ;[0573]
    jp      nz,$074b                        ;[0574]
    ld      hl,$0080                        ;[0577]
    push    hl                              ;[057a]
    ld      a,(hl)                          ;[057b]
    ld      c,a                             ;[057c]
    push    bc                              ;[057d]
    ld      a,$ff                           ;[057e]
    ld      bc,$ffff                        ;[0580]
    push    af                              ;[0583]
    call    SERIAL_IN_AVAIL                 ;[0584]
    pop     af                              ;[0587]
    jp      nz,$0592                        ;[0588]
    dec     bc                              ;[058b]
    jp      nz,$0583                        ;[058c]
    dec     a                               ;[058f]
    jr      nz,$0580                        ;[0590]
    call    $065f                           ;[0592]
    and     $7f                             ;[0595]
    push    hl                              ;[0597]
    ld      hl,$036d                        ;[0598]
    cp      (hl)                            ;[059b]
    pop     hl                              ;[059c]
    jp      nz,$05b1                        ;[059d]
    call    SERIAL_IN_AVAIL                 ;[05a0]
    jr      z,$05a0                         ;[05a3]
    call    $065f                           ;[05a5]
    push    hl                              ;[05a8]
    ld      hl,$036e                        ;[05a9]
    cp      (hl)                            ;[05ac]
    pop     hl                              ;[05ad]
    jp      nz,$05a0                        ;[05ae]
    pop     bc                              ;[05b1]
    ld      hl,$0662                        ;[05b2]
    ld      a,c                             ;[05b5]
    call    SERIAL_OUT                      ;[05b6]
    ld      a,h                             ;[05b9]
    or      a                               ;[05ba]
    jr      nz,$05c0                        ;[05bb]
    ld      e,c                             ;[05bd]
    jr      $05c2                           ;[05be]
    ld      e,$2e                           ;[05c0]
    call    C_OUT                           ;[05c2]
    pop     hl                              ;[05c5]
    inc     hl                              ;[05c6]
    ld      a,l                             ;[05c7]
    or      a                               ;[05c8]
    jp      z,$05cf                         ;[05c9]
    jp      $057a                           ;[05cc]
    ld      a,($07bb)                       ;[05cf]
    or      a                               ;[05d2]
    jp      nz,$05d9                        ;[05d3]
    jp      $0565                           ;[05d6]
    call    $0725                           ;[05d9]
    ld      de,$0c16                        ;[05dc]
    call    C_WRITESTR                      ;[05df]
    xor     a                               ;[05e2]
    ld      ($07bb),a                       ;[05e3]
    call    $038f                           ;[05e6]
    call    $0725                           ;[05e9]
    jp      MAIN_LOOP                       ;[05ec]
    ld      de,$0ee4                        ;[05ef]
    call    C_WRITESTR                      ;[05f2]
    call    $038f                           ;[05f5]
    jp      MAIN_LOOP                       ;[05f8]
    ret                                     ;[05fb]
    
    call    $0704                           ;[05fc]
    call    $0725                           ;[05ff]
    call    $086e                           ;[0602]
    call    L0833                           ;[0605]
    cp      $ff                             ;[0608]
    call    z,$085c                         ;[060a]
    cp      $ff                             ;[060d]
    ld      de,$0bc0                        ;[060f]
    jp      z,$0730                         ;[0612]
    ld      hl,$0080                        ;[0615]
    ld      ($0701),hl                      ;[0618]
    call    CONSOLE_INPUT                   ;[061b]
    call    $027f                           ;[061e]
    cp      $0d                             ;[0621]
    jr      z,$0632                         ;[0623]
    call    SERIAL_OUT                      ;[0625]
    call    SERIAL_IN                       ;[0628]
    and     $7f                             ;[062b]
    call    C_OUT                           ;[062d]
    jr      $061b                           ;[0630]
    ld      hl,$015b                        ;[0632]
    ld      a,(hl)                          ;[0635]
    or      a                               ;[0636]
    jr      z,$063b                         ;[0637]
    jr      $063d                           ;[0639]
    ld      a,$0d                           ;[063b]
    call    SERIAL_OUT                      ;[063d]
    call    $0a7b                           ;[0640]
    cp      $ff                             ;[0643]
    jr      nz,$0632                        ;[0645]
    call    SERIAL_IN                       ;[0647]
    and     $7f                             ;[064a]
    ld      hl,($0701)                      ;[064c]
    ld      bc,$0001                        ;[064f]
    call    $0a7b                           ;[0652]
    cp      $ff                             ;[0655]
    jp      nz,$0710                        ;[0657]
    call    $065f                           ;[065a]
    jr      $0665                           ;[065d]
    call    SERIAL_IN                       ;[065f]
    nop                                     ;[0662]
    nop                                     ;[0663]
    ret                                     ;[0664]
    
    ld      (hl),a                          ;[0665]
    ld      e,a                             ;[0666]
    ld      a,($0662)                       ;[0667]
    or      a                               ;[066a]
    jr      z,$066f                         ;[066b]
    jr      $0671                           ;[066d]
    ld      e,$2e                           ;[066f]
    call    C_OUT                           ;[0671]
    inc     hl                              ;[0674]
    ld      a,l                             ;[0675]
    or      a                               ;[0676]
    jp      nz,$064f                        ;[0677]
    call    $0680                           ;[067a]
    jp      $064c                           ;[067d]
    ld      hl,$1144                        ;[0680]
    ld      bc,$0000                        ;[0683]
    ld      a,($0104)                       ;[0686]
    or      a                               ;[0689]
    jr      z,$0694                         ;[068a]
    ld      a,($036f)                       ;[068c]
    call    SERIAL_OUT                      ;[068f]
    jr      $0697                           ;[0692]
    call    $0a4c                           ;[0694]
    push    bc                              ;[0697]
    ld      bc,$0001                        ;[0698]
    ld      de,$2000                        ;[069b]
    call    $0a83                           ;[069e]
    pop     bc                              ;[06a1]
    cp      $ff                             ;[06a2]
    jp      nz,$06c1                        ;[06a4]
    ld      a,$01                           ;[06a7]
    ld      ($0703),a                       ;[06a9]
    call    $065f                           ;[06ac]
    ld      (hl),a                          ;[06af]
    push    bc                              ;[06b0]
    ld      e,a                             ;[06b1]
    call    C_OUT                           ;[06b2]
    pop     bc                              ;[06b5]
    inc     bc                              ;[06b6]
    inc     hl                              ;[06b7]
    ld      a,c                             ;[06b8]
    cp      $0a                             ;[06b9]
    jp      z,$0686                         ;[06bb]
    jp      $0697                           ;[06be]
    push    bc                              ;[06c1]
    ld      c,$15                           ;[06c2]
    ld      de,$077a                        ;[06c4]
    ld      hl,$0080                        ;[06c7]
    call    SYSCALL                         ;[06ca]
    pop     bc                              ;[06cd]
    or      a                               ;[06ce]
    jp      nz,$0730                        ;[06cf]
    call    $0704                           ;[06d2]
    ld      a,($0703)                       ;[06d5]
    or      a                               ;[06d8]
    jr      z,$06fd                         ;[06d9]
    push    bc                              ;[06db]
    ld      de,$0080                        ;[06dc]
    ld      hl,$1144                        ;[06df]
    ldir                                    ;[06e2]
    pop     bc                              ;[06e4]
    ld      hl,$0080                        ;[06e5]
    add     hl,bc                           ;[06e8]
    ld      ($0701),hl                      ;[06e9]
    xor     a                               ;[06ec]
    ld      ($0703),a                       ;[06ed]
    ld      a,($0104)                       ;[06f0]
    or      a                               ;[06f3]
    jr      z,$06fd                         ;[06f4]
    ld      a,($0370)                       ;[06f6]
    call    SERIAL_OUT                      ;[06f9]
    ret                                     ;[06fc]
    
    call    $0a45                           ;[06fd]
    ret                                     ;[0700]
    
    nop                                     ;[0701]
    nop                                     ;[0702]
    nop                                     ;[0703]
    ld      b,$80                           ;[0704]
    ld      hl,$0080                        ;[0706]
    ld      a,$20                           ;[0709]
    ld      (hl),a                          ;[070b]
    inc     hl                              ;[070c]
    djnz    $070b                           ;[070d]
    ret                                     ;[070f]
    
    call    $0680                           ;[0710]
    call    $0865                           ;[0713]
    call    $0853                           ;[0716]
    call    $0874                           ;[0719]
    ld      de,$0be5                        ;[071c]
    call    C_WRITESTR                      ;[071f]
    jp      MAIN_LOOP                       ;[0722]
    ld      c,$0d                           ;[0725]
    call    CONSOLE_OUTPUT                  ;[0727]
    ld      c,$0a                           ;[072a]
    call    CONSOLE_OUTPUT                  ;[072c]
    ret                                     ;[072f]
    
    call    C_WRITESTR                      ;[0730]
    jp      MAIN_LOOP                       ;[0733]
    ld      de,$0bd1                        ;[0736]
    call    C_WRITESTR                      ;[0739]
    jp      ENTRY_POINT                     ;[073c]
    ld      hl,$0757                        ;[073f]
    ld      b,$0b                           ;[0742]
    ld      a,$20                           ;[0744]
    ld      (hl),a                          ;[0746]
    inc     hl                              ;[0747]
    djnz    $0746                           ;[0748]
    ret                                     ;[074a]
    
    ld      a,$01                           ;[074b]
    ld      ($07bb),a                       ;[074d]
    jp      $0577                           ;[0750]
    jp      MAIN_LOOP                       ;[0753]
    nop                                     ;[0756]
    jr      nz,$0779                        ;[0757]
    jr      nz,$077b                        ;[0759]
    jr      nz,$077d                        ;[075b]
    jr      nz,$077f                        ;[075d]
    jr      nz,$0781                        ;[075f]
    jr      nz,$0763                        ;[0761]
    
    nop                                     ;[0763]
    nop                                     ;[0764]
    nop                                     ;[0765]
    nop                                     ;[0766]
    nop                                     ;[0767]
    nop                                     ;[0768]
    nop                                     ;[0769]
    nop                                     ;[076a]
    nop                                     ;[076b]
    nop                                     ;[076c]
    nop                                     ;[076d]
    nop                                     ;[076e]
    nop                                     ;[076f]
    nop                                     ;[0770]
    nop                                     ;[0771]
    nop                                     ;[0772]
    nop                                     ;[0773]
    nop                                     ;[0774]
    nop                                     ;[0775]
    nop                                     ;[0776]
    nop                                     ;[0777]
    nop                                     ;[0778]
    nop                                     ;[0779]
    nop                                     ;[077a]
    jr      nz,$079d                        ;[077b]
    jr      nz,$079f                        ;[077d]
    jr      nz,$07a1                        ;[077f]
    jr      nz,$07a3                        ;[0781]
    inc     h                               ;[0783]
    inc     h                               ;[0784]
    inc     h                               ;[0785]
    nop                                     ;[0786]
    nop                                     ;[0787]
    nop                                     ;[0788]
    nop                                     ;[0789]
    nop                                     ;[078a]
    nop                                     ;[078b]
    nop                                     ;[078c]
    nop                                     ;[078d]
    nop                                     ;[078e]
    nop                                     ;[078f]
    nop                                     ;[0790]
    nop                                     ;[0791]
    nop                                     ;[0792]
    nop                                     ;[0793]
    nop                                     ;[0794]
    nop                                     ;[0795]
    nop                                     ;[0796]
    nop                                     ;[0797]
    nop                                     ;[0798]
    nop                                     ;[0799]
    nop                                     ;[079a]
    nop                                     ;[079b]
    nop                                     ;[079c]
    nop                                     ;[079d]
    nop                                     ;[079e]
    jr      nz,$07c1                        ;[079f]
    jr      nz,$07c3                        ;[07a1]
    jr      nz,$07c5                        ;[07a3]
    jr      nz,$07c7                        ;[07a5]
    jr      nz,$07c9                        ;[07a7]
    jr      nz,$07cb                        ;[07a9]
    nop                                     ;[07ab]
    nop                                     ;[07ac]
    nop                                     ;[07ad]
    nop                                     ;[07ae]
    jr      nz,$07d1                        ;[07af]
    jr      nz,$07d3                        ;[07b1]
    jr      nz,$07d5                        ;[07b3]
    jr      nz,$07d7                        ;[07b5]
    jr      nz,$07d9                        ;[07b7]
    jr      nz,$07db                        ;[07b9]
    nop                                     ;[07bb]
    nop                                     ;[07bc]
    nop                                     ;[07bd]
    nop                                     ;[07be]
    nop                                     ;[07bf]
    nop                                     ;[07c0]
    nop                                     ;[07c1]
    nop                                     ;[07c2]
    nop                                     ;[07c3]
    nop                                     ;[07c4]
    nop                                     ;[07c5]
    nop                                     ;[07c6]
    nop                                     ;[07c7]
    nop                                     ;[07c8]
    nop                                     ;[07c9]
    nop                                     ;[07ca]
    nop                                     ;[07cb]
    nop                                     ;[07cc]
    nop                                     ;[07cd]
    nop                                     ;[07ce]
    nop                                     ;[07cf]
    nop                                     ;[07d0]
    nop                                     ;[07d1]
    nop                                     ;[07d2]
    nop                                     ;[07d3]
    nop                                     ;[07d4]
    nop                                     ;[07d5]
    nop                                     ;[07d6]
    nop                                     ;[07d7]
    nop                                     ;[07d8]
    nop                                     ;[07d9]
    nop                                     ;[07da]
    nop                                     ;[07db]
    nop                                     ;[07dc]
    nop                                     ;[07dd]
    nop                                     ;[07de]
    nop                                     ;[07df]
    nop                                     ;[07e0]
    nop                                     ;[07e1]
    nop                                     ;[07e2]
    nop                                     ;[07e3]
    nop                                     ;[07e4]
    nop                                     ;[07e5]
    nop                                     ;[07e6]
    nop                                     ;[07e7]
    nop                                     ;[07e8]
    nop                                     ;[07e9]
    nop                                     ;[07ea]
    nop                                     ;[07eb]
    nop                                     ;[07ec]
    nop                                     ;[07ed]
    nop                                     ;[07ee]
    nop                                     ;[07ef]
    nop                                     ;[07f0]
    nop                                     ;[07f1]
    nop                                     ;[07f2]
    nop                                     ;[07f3]
    nop                                     ;[07f4]
    nop                                     ;[07f5]
    nop                                     ;[07f6]
    nop                                     ;[07f7]
    nop                                     ;[07f8]
    nop                                     ;[07f9]
    nop                                     ;[07fa]
    nop                                     ;[07fb]
    nop                                     ;[07fc]
    nop                                     ;[07fd]
    nop                                     ;[07fe]
    nop                                     ;[07ff]
    nop                                     ;[0800]
    nop                                     ;[0801]
    nop                                     ;[0802]
    nop                                     ;[0803]
    nop                                     ;[0804]
    nop                                     ;[0805]
    nop                                     ;[0806]
    nop                                     ;[0807]
    nop                                     ;[0808]
    nop                                     ;[0809]
    nop                                     ;[080a]
    nop                                     ;[080b]
    nop                                     ;[080c]
    nop                                     ;[080d]
    nop                                     ;[080e]
    nop                                     ;[080f]
    nop                                     ;[0810]
    nop                                     ;[0811]
    nop                                     ;[0812]
    nop                                     ;[0813]
    nop                                     ;[0814]
    nop                                     ;[0815]
    nop                                     ;[0816]
    nop                                     ;[0817]
    nop                                     ;[0818]
    nop                                     ;[0819]
    nop                                     ;[081a]
    nop                                     ;[081b]
    nop                                     ;[081c]
    nop                                     ;[081d]
    nop                                     ;[081e]
    nop                                     ;[081f]
; STACK space starts from here (GROWS UPWARD)
    
SYSCALL:
    push    hl                              ;[0820]
    push    bc                              ;[0821]
    push    de                              ;[0822]
    call    $0005                           ;[0823]
    pop     de                              ;[0826]
    pop     bc                              ;[0827]
    pop     hl                              ;[0828]
    ret                                     ;[0829]
    
L082A:
    ld      c,$0f                           ;[082a]
    ld      de,$0756                        ;[082c]
    call    SYSCALL                         ;[082f]
    ret                                     ;[0832]
    
L0833:
    ld      hl,$0756                        ;[0833]
    ld      de,$077a                        ;[0836]
    ld      bc,$0009                        ;[0839]
    ldir                                    ;[083c]
    ld      c,$0f                           ;[083e]
    ld      de,$077a                        ;[0840]
    call    SYSCALL                         ;[0843]
    ret                                     ;[0846]
    
C_OUT:
    ld      c,$02                           ;[0847]
    call    SYSCALL                         ;[0849]
    ret                                     ;[084c]
    
C_WRITESTR:
    ld      c,$09                           ;[084d]
    call    SYSCALL                         ;[084f]
    ret                                     ;[0852]
    
L8053:
    ld      c,$13                           ;[0853]
    ld      de,$0756                        ;[0855]
    call    SYSCALL                         ;[0858]
    ret                                     ;[085b]
    
L085C:
    ld      c,$16                           ;[085c]
    ld      de,$077a                        ;[085e]
    call    SYSCALL                         ;[0861]
    ret                                     ;[0864]
    
L0865:
    ld      c,$10                           ;[0865]
    ld      de,$077a                        ;[0867]
    call    SYSCALL                         ;[086a]
    ret                                     ;[086d]
    
L086E:
    ld      c,$0d                           ;[086e]
    call    SYSCALL                         ;[0870]
    ret                                     ;[0873]
    
    ld      hl,$077a                        ;[0874]
    ld      de,$079e                        ;[0877]
    ld      bc,$0010                        ;[087a]
    ldir                                    ;[087d]
    ld      hl,$0756                        ;[087f]
    ld      de,$07ae                        ;[0882]
    ld      bc,$0010                        ;[0885]
    ldir                                    ;[0888]
    ld      c,$17                           ;[088a]
    ld      de,$079e                        ;[088c]
    call    SYSCALL                         ;[088f]
    cp      $ff                             ;[0892]
    ret     nz                              ;[0894]
    jp      $0730                           ;[0895]
    ld      de,$0f06                        ;[0898]
    call    C_WRITESTR                      ;[089b]
    call    $0903                           ;[089e]
    ld      a,($091b)                       ;[08a1]
    inc     a                               ;[08a4]
    ld      ($091b),a                       ;[08a5]
    ld      hl,($0919)                      ;[08a8]
    ld      a,(hl)                          ;[08ab]
    inc     hl                              ;[08ac]
    ld      ($0919),hl                      ;[08ad]
    or      a                               ;[08b0]
    jr      nz,$08b5                        ;[08b1]
    add     $30                             ;[08b3]
    cp      $01                             ;[08b5]
    jr      nz,$08bb                        ;[08b7]
    add     $30                             ;[08b9]
    cp      $0d                             ;[08bb]
    jr      z,$08d0                         ;[08bd]
    push    af                              ;[08bf]
    ld      e,a                             ;[08c0]
    call    C_OUT                           ;[08c1]
    pop     af                              ;[08c4]
    ld      a,($091b)                       ;[08c5]
    cp      $04                             ;[08c8]
    jp      nc,$08a1                        ;[08ca]
    jp      $089e                           ;[08cd]
    xor     a                               ;[08d0]
    ld      ($091b),a                       ;[08d1]
    call    $08f2                           ;[08d4]
    inc     hl                              ;[08d7]
    inc     hl                              ;[08d8]
    inc     hl                              ;[08d9]
    ld      ($0919),hl                      ;[08da]
    call    $08f2                           ;[08dd]
    dec     hl                              ;[08e0]
    dec     hl                              ;[08e1]
    ld      ($0919),hl                      ;[08e2]
    call    $08f2                           ;[08e5]
    inc     hl                              ;[08e8]
    ld      ($0919),hl                      ;[08e9]
    call    $08f2                           ;[08ec]
    jp      $093c                           ;[08ef]
    call    $0903                           ;[08f2]
    ld      hl,($0919)                      ;[08f5]
    ld      a,(hl)                          ;[08f8]
    call    $11ca                           ;[08f9]
    ld      de,$11fe                        ;[08fc]
    call    C_WRITESTR                      ;[08ff]
    ret                                     ;[0902]
    
    ld      b,$04                           ;[0903]
    push    hl                              ;[0905]
    push    bc                              ;[0906]
    ld      hl,($0917)                      ;[0907]
    ld      e,(hl)                          ;[090a]
    call    C_OUT                           ;[090b]
    inc     hl                              ;[090e]
    pop     bc                              ;[090f]
    ld      ($0917),hl                      ;[0910]
    djnz    $0906                           ;[0913]
    pop     hl                              ;[0915]
    ret                                     ;[0916]
    
    inc     e                               ;[0917]
    add     hl,bc                           ;[0918]
    inc     bc                              ;[0919]
    ld      bc,$1b00                        ;[091a]
    dec     a                               ;[091d]
    dec     h                               ;[091e]
    inc     a                               ;[091f]
    dec     de                              ;[0920]
    dec     a                               ;[0921]
    daa                                     ;[0922]
    inc     a                               ;[0923]
    dec     de                              ;[0924]
    dec     a                               ;[0925]
    add     hl,hl                           ;[0926]
    inc     a                               ;[0927]
    dec     de                              ;[0928]
    dec     a                               ;[0929]
    dec     hl                              ;[092a]
    ld      b,h                             ;[092b]
    dec     de                              ;[092c]
    dec     a                               ;[092d]
    ld      sp,$1b3c                        ;[092e]
    dec     a                               ;[0931]
    inc     sp                              ;[0932]
    inc     a                               ;[0933]
    dec     de                              ;[0934]
    dec     a                               ;[0935]
    dec     (hl)                            ;[0936]
    inc     a                               ;[0937]
    dec     de                              ;[0938]
    dec     a                               ;[0939]
    scf                                     ;[093a]
    inc     a                               ;[093b]
    ld      hl,$0103                        ;[093c]
    ld      ($0919),hl                      ;[093f]
    ld      hl,$091c                        ;[0942]
    ld      ($0917),hl                      ;[0945]
    call    CONSOLE_INPUT                   ;[0948]
    call    $027f                           ;[094b]
    cp      $0d                             ;[094e]
    jp      z,$0960                         ;[0950]
    cp      $0b                             ;[0953]
    jp      z,$0960                         ;[0955]
    cp      $0c                             ;[0958]
    jp      z,$0960                         ;[095a]
    jp      $093c                           ;[095d]
    nop                                     ;[0960]
    ld      hl,$0757                        ;[0961]
    ld      a,$3f                           ;[0964]
    ld      b,$0c                           ;[0966]
    ld      (hl),a                          ;[0968]
    inc     hl                              ;[0969]
    dec     b                               ;[096a]
    jp      nz,$0968                        ;[096b]
    ld      de,$0e99                        ;[096e]
    call    C_WRITESTR                      ;[0971]
    call    CONSOLE_INPUT                   ;[0974]
    call    $027f                           ;[0977]
    push    af                              ;[097a]
    ld      e,a                             ;[097b]
    call    C_OUT                           ;[097c]
    pop     af                              ;[097f]
    ld      hl,$0756                        ;[0980]
    cp      $44                             ;[0983]
    jp      nc,ENTRY_POINT                  ;[0985]
    sub     $40                             ;[0988]
    ld      (hl),a                          ;[098a]
    ld      de,$0e96                        ;[098b]
    call    C_WRITESTR                      ;[098e]
    ld      de,$0e96                        ;[0991]
    call    C_WRITESTR                      ;[0994]
    ld      de,$0756                        ;[0997]
    ld      c,$11                           ;[099a]
    call    SYSCALL                         ;[099c]
    push    af                              ;[099f]
    xor     a                               ;[09a0]
    ld      ($0960),a                       ;[09a1]
    pop     af                              ;[09a4]
    call    $09d3                           ;[09a5]
    ld      de,$0080                        ;[09a8]
    ld      c,$1a                           ;[09ab]
    call    SYSCALL                         ;[09ad]
    ld      de,$0756                        ;[09b0]
    ld      c,$12                           ;[09b3]
    call    SYSCALL                         ;[09b5]
    cp      $ff                             ;[09b8]
    jp      nz,$09a5                        ;[09ba]
    ld      e,$0d                           ;[09bd]
    call    C_OUT                           ;[09bf]
    ld      e,$0a                           ;[09c2]
    call    C_OUT                           ;[09c4]
    call    CONSOLE_INPUT                   ;[09c7]
    xor     a                               ;[09ca]
    ld      ($0960),a                       ;[09cb]
    jp      ENTRY_POINT                     ;[09ce]
    nop                                     ;[09d1]
    nop                                     ;[09d2]
    ld      ($09d1),a                       ;[09d3]
    push    af                              ;[09d6]
    ld      a,($0960)                       ;[09d7]
    cp      $05                             ;[09da]
    jp      nz,$09e9                        ;[09dc]
    ld      de,$0e96                        ;[09df]
    call    C_WRITESTR                      ;[09e2]
    xor     a                               ;[09e5]
    ld      ($0960),a                       ;[09e6]
    pop     af                              ;[09e9]
    ld      e,$20                           ;[09ea]
    call    C_OUT                           ;[09ec]
    ld      a,($09d1)                       ;[09ef]
    add     a                               ;[09f2]
    add     a                               ;[09f3]
    add     a                               ;[09f4]
    add     a                               ;[09f5]
    add     a                               ;[09f6]
    ld      ($09d1),a                       ;[09f7]
    ld      de,($09d1)                      ;[09fa]
    ld      hl,$0080                        ;[09fe]
    add     hl,de                           ;[0a01]
    ld      a,(hl)                          ;[0a02]
    cp      $e5                             ;[0a03]
    jp      z,$0a35                         ;[0a05]
    push    hl                              ;[0a08]
    ld      de,$000c                        ;[0a09]
    add     hl,de                           ;[0a0c]
    ld      a,(hl)                          ;[0a0d]
    or      a                               ;[0a0e]
    pop     hl                              ;[0a0f]
    jp      nz,$0a35                        ;[0a10]
    inc     hl                              ;[0a13]
    ld      b,$08                           ;[0a14]
    call    $0a3b                           ;[0a16]
    ld      e,$2e                           ;[0a19]
    call    C_OUT                           ;[0a1b]
    ld      b,$03                           ;[0a1e]
    call    $0a3b                           ;[0a20]
    ld      e,$20                           ;[0a23]
    call    C_OUT                           ;[0a25]
    ld      e,$3a                           ;[0a28]
    call    C_OUT                           ;[0a2a]
    ld      a,($0960)                       ;[0a2d]
    inc     a                               ;[0a30]
    ld      ($0960),a                       ;[0a31]
    ret                                     ;[0a34]
    
    ld      e,$08                           ;[0a35]
    call    C_OUT                           ;[0a37]
    ret                                     ;[0a3a]
    
    ld      e,(hl)                          ;[0a3b]
    call    C_OUT                           ;[0a3c]
    inc     hl                              ;[0a3f]
    dec     b                               ;[0a40]
    jp      nz,$0a3b                        ;[0a41]
    ret                                     ;[0a44]
    
    ld      a,($036e)                       ;[0a45]
    call    SERIAL_OUT                      ;[0a48]
    ret                                     ;[0a4b]
    
    push    af                              ;[0a4c]
    ld      a,($036d)                       ;[0a4d]
    call    SERIAL_OUT                      ;[0a50]
    pop     af                              ;[0a53]
    ret                                     ;[0a54]
    
    nop                                     ;[0a55]
    push    bc                              ;[0a56]
    push    de                              ;[0a57]
    push    hl                              ;[0a58]
    ld      b,$02                           ;[0a59]
    ld      de,$9000                        ;[0a5b]
    push    af                              ;[0a5e]
    push    bc                              ;[0a5f]
    rl      a                               ;[0a60]
    dec     de                              ;[0a62]
    ld      a,d                             ;[0a63]
    or      a                               ;[0a64]
    jr      nz,$0a60                        ;[0a65]
    pop     bc                              ;[0a67]
    pop     af                              ;[0a68]
    djnz    $0a5b                           ;[0a69]
    dec     a                               ;[0a6b]
    jr      nz,$0a59                        ;[0a6c]
    pop     hl                              ;[0a6e]
    pop     de                              ;[0a6f]
    pop     bc                              ;[0a70]
    ret                                     ;[0a71]
    
    ld      b,$06                           ;[0a72]
    xor     a                               ;[0a74]
    call    SERIAL_OUT                      ;[0a75]
    djnz    $0a74                           ;[0a78]
    ret                                     ;[0a7a]
    
    push    bc                              ;[0a7b]
    push    de                              ;[0a7c]
    ld      bc,$ffff                        ;[0a7d]
    ld      de,$8000                        ;[0a80]
    call    SERIAL_IN_AVAIL                 ;[0a83]
    jp      nz,$0a98                        ;[0a86]
    dec     de                              ;[0a89]
    ld      a,d                             ;[0a8a]
    or      e                               ;[0a8b]
    jp      nz,$0a83                        ;[0a8c]
    dec     bc                              ;[0a8f]
    ld      a,b                             ;[0a90]
    or      c                               ;[0a91]
    jp      nz,$0a8f                        ;[0a92]
    pop     de                              ;[0a95]
    pop     bc                              ;[0a96]
    ret                                     ;[0a97]
    
    ld      a,$ff                           ;[0a98]
    pop     de                              ;[0a9a]
    pop     bc                              ;[0a9b]
    ret                                     ;[0a9c]
    
    
; At the end of the execution in ($0AE7) there will be a 2 byte value representing the sum
; of all of the content of memory starting from $03DA up until the content of the memory is =$24
; Expected result = $49ea (????)
L0A9D:
    ld      hl,$0000                        ;[0a9d]
    ld      ($0ae7),hl                      ;[0aa0] ($0ae7) = $0000
    ld      hl,$0d3a                        ;[0aa3]
L0AA6:
    ld      a,(hl)                          ;[0aa6]
    cp      $24                             ;[0aa7]
    ret     z                               ;[0aa9] if ($0d3a) == $24 then return
    push    hl                              ;[0aaa]
    ld      hl,($0ae7)                      ;[0aab]
    ld      e,a                             ;[0aae]
    ld      d,$00                           ;[0aaf]
    add     hl,de                           ;[0ab1]
    ld      ($0ae7),hl                      ;[0ab2]
    pop     hl                              ;[0ab5]
    inc     hl                              ;[0ab6]
    jp      L0AA6                           ;[0ab7]
    
    
; Check if there is a character available to read from the SIO, {$00=not available,$01=available}
;   Get data from the #port stored at address $0116 and the value stored at address $0117 ($01 (?)) and
;   perform an AND operation between them
SERIAL_IN_AVAIL:
    push    hl                              ;[0aba]
    push    bc                              ;[0abb]
    ld      hl,$0116                        ;[0abc]
    ld      c,(hl)                          ;[0abf]
    in      a,(c)                           ;[0ac0]
    inc     hl                              ;[0ac2]
    ld      c,(hl)                          ;[0ac3]
    and     c                               ;[0ac4]
    pop     bc                              ;[0ac5]
    pop     hl                              ;[0ac6]
    ret                                     ;[0ac7]
    
    
; Get input in A register and disable receive
SERIAL_IN:
    in      a,($b0)                         ;[0ac8]
    push    af                              ;[0aca]
    call    SERIAL_NOT_READY_SIGNAL         ;[0acb]
    pop     af                              ;[0ace]
    ret                                     ;[0acf]
    
; Wait for the SIO's transmit buffer to be empty and then send the value stored in A
SERIAL_OUT:
    push    hl                              ;[0ad0]
    push    bc                              ;[0ad1]
    push    af                              ;[0ad2]
WAIT_EMPTY_TX_BUFFER:
    ld      hl,$0116                        ;[0ad3]
    ld      c,(hl)                          ;[0ad6]
    in      a,(c)                           ;[0ad7] Read SIO's RR0
    inc     hl                              ;[0ad9]
    inc     hl                              ;[0ada]
    ld      c,(hl)                          ;[0adb]
    and     c                               ;[0adc]
    jr      z,WAIT_EMPTY_TX_BUFFER          ;[0add] Jump if SIO's transmit buffer is not empty
    inc     hl                              ;[0adf]
    ld      c,(hl)                          ;[0ae0]
    pop     af                              ;[0ae1]
    out     (c),a                           ;[0ae2] Transmit value of A
    pop     bc                              ;[0ae4]
    pop     hl                              ;[0ae5]
    ret                                     ;[0ae6]
    
    DB $00                                  ;[0ae7]
    DB $00                                  ;[0ae8]
    
    ld      a,$12                           ;[0ae9]
    ld      ($0b0d),a                       ;[0aeb]
    ld      ($0b0e),a                       ;[0aee]
    ld      hl,$0080                        ;[0af1]
    xor     a                               ;[0af4]
    ld      e,(hl)                          ;[0af5]
    inc     hl                              ;[0af6]
    push    hl                              ;[0af7]
    call    $0b0f                           ;[0af8]
    ld      ($0b0c),a                       ;[0afb]
    pop     hl                              ;[0afe]
    ld      a,l                             ;[0aff]
    or      a                               ;[0b00]
    ld      a,($0b0c)                       ;[0b01]
    jr      nz,$0af5                        ;[0b04]
    ld      e,$00                           ;[0b06]
    call    $0b0f                           ;[0b08]
    ret                                     ;[0b0b]
    
    nop                                     ;[0b0c]
    nop                                     ;[0b0d]
    nop                                     ;[0b0e]
    ld      b,$08                           ;[0b0f]
    bit     7,a                             ;[0b11]
    jr      z,$0b1c                         ;[0b13]
    ld      hl,$0b0d                        ;[0b15]
    xor     (hl)                            ;[0b18]
    ld      ($0b0e),a                       ;[0b19]
    sla     a                               ;[0b1c]
    sla     e                               ;[0b1e]
    jr      nc,$0b24                        ;[0b20]
    set     0,a                             ;[0b22]
    dec     b                               ;[0b24]
    jr      nz,$0b11                        ;[0b25]
    ret                                     ;[0b27]
    
    DB      $0D                             ;[0b28]
    DB      $0A                             ;[0b29]
    DB      "EMISSION D'UN FICHIER   $"     ;[0b2a-
    
    DB      $0D                             ;[0b43]
    DB      $0A                             ;[0b44]
    DB      "FICHIER ASCII ? (O/N)  :$"     ;[0b45-
    
    DB      $0D                             ;[0b53]
    DB      $0A                             ;[0b5f]
    DB      "RECEPTION D'UN FICHIER  $"     ;[0b60-
    
    DB      $0D                             ;[0b79]
    DB      $0A                             ;[0b7a]
    DB      "SUR QUEL DISQUE (A B C) ? $"   ;[0b7b-
    
    DB      $0D                             ;[0b96]
    DB      $0A                             ;[0b87]
    DB      "NOM DU FICHIER  $"             ;[0b98-
    
    DB      $0D                             ;[0ba9]
    DB      $0A                             ;[0baa]
    DB      "FICHIER INEXISTANT"            ;[0bab-
    DB      $0D                             ;[0bbd]
    DB      $0A                             ;[0bbe]
    DB      $24                             ;[0bbf]
    
    DB      $0D                             ;[0bc0]
    DB      $0A                             ;[0bc1]
    DB      "DISQUE PLEIN"                  ;[0bc2-
    DB      $0D                             ;[0bce]
    DB      $0A                             ;[0bcf]
    DB      $24                             ;[0bd0]
    
    DB      $0D                             ;[0bd1]
    DB      $0A                             ;[0bd2]
    DB      "MAUVAISE ENTREE"               ;[0bd3-
    DB      $0D                             ;[0be2]
    DB      $0A                             ;[0be3]
    DB      $24                             ;[0be4]
    
    DB      $0D                             ;[0be5]
    DB      $0A                             ;[0be6]
    DB      "FICHIER RECU ET ECRIT"         ;[0be7-
    DB      $0D                             ;[0bfc]
    DB      $0A                             ;[0bfd]
    DB      $24                             ;[0bfe]
    
    DB      $0D                             ;[0bff]
    DB      $0A                             ;[0c00]
    DB      "TRANSFERT EN COURS"            ;[0c01-
    DB      $0D                             ;[0c13]
    DB      $0A                             ;[0c14]
    DB      $24                             ;[0c15]
    
    DB      $0D                             ;[0c16]
    DB      $0A                             ;[0c17]
    DB      "TRANSFERT TERMINE"             ;[0c18-
    DB      $0D                             ;[0c29]
    DB      $0A                             ;[0c2a]
    DB      $0D                             ;[0c2b]
    DB      $0A                             ;[0c2c]
    DB      "ATTENDEZ DE SAVOIR SI VOUS AVEZ LA MAIN";[0c2d-
    DB      $0D                             ;[0c54]
    DB      $0A                             ;[0c55]
    DB      "A L'APPARITION D'UN 'PROMPT' OU D'UNE '*' ET";[0c56-
    DB      $0D                             ;[0c82]
    DB      $0A                             ;[0c83]
    DB      "ENTREZ (SAVE) AU CLAVIER SI C'EST UN NOUVEAU FICHIER";[0c84-
    DB      $0D                             ;[0cb8]
    DB      $0A                             ;[0cb9]
    DB      "OU (REPLACE) S'IL EXISTE DEJA" ;[0cba-
    DB      $0D                             ;[0cd7]
    DB      $0A                             ;[0cd8]
    DB      $24                             ;[0cd9]
    
    DB      $1A                             ;[0cda]
    DB      $1B                             ;[0cdb]
    DB      "=#%SANCO A SANCO :OUI $"       ;[0cdc-
    
    DB      $1A                             ;[0cf3]
    DB      $1B                             ;[0cf4]
    DB      "=#%SANCO A SANCO :NON $"       ;[0cf5-
    
    DB      $1B                             ;[0d0c]
    DB      "=#>VIA TRANSPAC :OUI $"        ;[0d0d-
    
    DB      $1B                             ;[0d23]
    DB      "=#>PAR TRANSPAC :NON $"        ;[0d24-
    
    DB      $1B                             ;[0d3a]
    DB      "=!! (C) S.F.C.E 10/01/82 POUR SANCO-IBEX";[0d3b-
    DB      $1B                             ;[0d63]
    DB      $48                             ;[0d64]
    DB      $1B                             ;[0d65]
    DB      "=(* SANCONET  CLUB DES UTILISATEURS SANCO ";[0d66-
    DB      $1B                             ;[0d90]
    DB      $49                             ;[0d91]
    DB      $1B                             ;[0d92]
    DB      "=,*CTRL-D RETOUR AU MENU PRINCIPAL";[0d93-
    DB      $1B                             ;[0db5]
    DB      "=.*CTRL-T MISE EN LIAISON"     ;[0db6-
    DB      $1B                             ;[0dcf]
    DB      "=0*CTRL-L EMISSION D'UN FICHIER DU DISQUE";[0dd0-
    DB      $1B                             ;[0df9]
    DB      "=2*CTRL-W RECEPTION D'UN FICHIER SUR DISQUE";[0dfa-
    DB      $1B                             ;[0e25]
    DB      "=4*CTRL-A AFFICHAGE DU CATALOGUE DU DISQUE";[0e26-
    DB      $1B                             ;[0e50]
    DB      "=6/VOTRE CHOIX? :$"            ;[0e51-
    
INIT_STRING:
    DB      $1A                             ;[0e63]
    DB      $0D                             ;[0e64]
    DB      $0A                             ;[0e65]
    DB      $0A                             ;[0e66]
    DB      $0A                             ;[0e67]
    DB      "TERM80 VER 1.0 (C) S.F.C.E"    ;[0e68-
    DB      $0D                             ;[0e80]
    DB      $0A                             ;[0e81]
    DB      $0D                             ;[0e82]
    DB      $0A                             ;[0e83]
    DB      "LIAISON EN COURS"              ;[0e86-
    DB      $0D                             ;[0e96]
    DB      $0A                             ;[0e97]
    DB      $24                             ;[0e98]
    
    
    DB      $1A                             ;[0e99]
    DB      $1B                             ;[0e9A]
    DB      "=%/AFFICHAGE DE LA DIRECTORY DU DRIVE : $";[0e9b-
    DB      $0D                             ;[0ec4]
    DB      $0A                             ;[0ec5]
    DB      "APPUYER SUR LA TOUCHE RETURN $";[0ec6-
    DB      $0D                             ;[0ee4]
    DB      $0A                             ;[0ee5]
    DB      "PARASITE OU RUPTURE DE LIGNE " ;[0ee6-
    DB      $0D                             ;[0f03]
    DB      $0A                             ;[0f04]
    DB      $24                             ;[0f05]
    
    
    DB      $1A                             ;[0f06]
    DB      $0D                             ;[0f07]
    DB      $0A                             ;[0f08]
    DB      $0D                             ;[0f09]
    DB      $0A                             ;[0f0a]
    DB      $09                             ;[0f0b]
    DB      $09                             ;[0f0c]
    DB      "OUI = 1"                       ;[0f0d-
    DB      $09                             ;[0f14]
    DB      $09                             ;[0f15]
    DB      $09                             ;[0f16]
    DB      "NON = 0"                       ;[0f17-
    DB      $1B                             ;[0f1e]
    DB      "=%*SANCO A SANCO :      "      ;[0f1f-
    DB      $1B                             ;[0f37]
    DB      "='*VIA TRANSPAC  :      "      ;[0f38-
    DB      $1B                             ;[0f50]
    DB      "=)*APPEL AUTOMATIQUE :  "      ;[0f51-
    DB      $1B                             ;[0f69]
    DB      "=+*SI OUI APPEL DE LA BASE :                ";[0f6a-
    DB      $1B                             ;[0f96]
    DB      "=-*pour modifier deplacez le curseur ou return pour sortir";[0f97-
    DB      $0D                             ;[0fd1]
    DB      $0A                             ;[0fd2]
    DB      "-----------------------------------------------------------";[0fd3-
    DB      $0D                             ;[100e]
    DB      $0A                             ;[100f]
    DB      "partie technique a ne modifier qu'avec l'accord de votre installateur ";[1010-
    DB      $1B                             ;[1056]
    DB      "=1*PORT DE STATUS   =   "      ;[1057-
    DB      $1B                             ;[106f]
    DB      "=3*PORT DE DATA     =   "      ;[1070-
    DB      $1B                             ;[1088]
    DB      "=5*MASQUE D'ENTREE  =   "      ;[1089-
    DB      $1B                             ;[10a1]
    DB      "=7*MASQUE DE SORTIE =   "      ;[10a2-
    DB      $1B                             ;[10ba]
    DB      "=.!$"                          ;[10bb-
    DB      "*"                             ;[10bf]
    
    nop                                     ;[10c0]
    nop                                     ;[10c1]
    nop                                     ;[10c2]
    nop                                     ;[10c3]
    nop                                     ;[10c4]
    nop                                     ;[10c5]
    nop                                     ;[10c6]
    nop                                     ;[10c7]
    nop                                     ;[10c8]
    nop                                     ;[10c9]
    nop                                     ;[10ca]
    nop                                     ;[10cb]
    nop                                     ;[10cc]
    nop                                     ;[10cd]
    nop                                     ;[10ce]
    nop                                     ;[10cf]
    nop                                     ;[10d0]
    nop                                     ;[10d1]
    nop                                     ;[10d2]
    nop                                     ;[10d3]
    nop                                     ;[10d4]
    nop                                     ;[10d5]
    nop                                     ;[10d6]
    nop                                     ;[10d7]
    nop                                     ;[10d8]
    nop                                     ;[10d9]
    nop                                     ;[10da]
    nop                                     ;[10db]
    nop                                     ;[10dc]
    nop                                     ;[10dd]
    nop                                     ;[10de]
    nop                                     ;[10df]
    nop                                     ;[10e0]
    nop                                     ;[10e1]
    nop                                     ;[10e2]
    nop                                     ;[10e3]
    nop                                     ;[10e4]
    nop                                     ;[10e5]
    nop                                     ;[10e6]
    nop                                     ;[10e7]
    nop                                     ;[10e8]
    nop                                     ;[10e9]
    nop                                     ;[10ea]
    nop                                     ;[10eb]
    nop                                     ;[10ec]
    nop                                     ;[10ed]
    nop                                     ;[10ee]
    nop                                     ;[10ef]
    nop                                     ;[10f0]
    nop                                     ;[10f1]
    nop                                     ;[10f2]
    nop                                     ;[10f3]
    nop                                     ;[10f4]
    nop                                     ;[10f5]
    nop                                     ;[10f6]
    nop                                     ;[10f7]
    nop                                     ;[10f8]
    nop                                     ;[10f9]
    nop                                     ;[10fa]
    nop                                     ;[10fb]
    nop                                     ;[10fc]
    nop                                     ;[10fd]
    nop                                     ;[10fe]
    nop                                     ;[10ff]
    nop                                     ;[1100]
    nop                                     ;[1101]
    nop                                     ;[1102]
    nop                                     ;[1103]
    nop                                     ;[1104]
    nop                                     ;[1105]
    nop                                     ;[1106]
    nop                                     ;[1107]
    nop                                     ;[1108]
    nop                                     ;[1109]
    nop                                     ;[110a]
    nop                                     ;[110b]
    nop                                     ;[110c]
    nop                                     ;[110d]
    nop                                     ;[110e]
    nop                                     ;[110f]
    nop                                     ;[1110]
    nop                                     ;[1111]
    nop                                     ;[1112]
    nop                                     ;[1113]
    nop                                     ;[1114]
    nop                                     ;[1115]
    nop                                     ;[1116]
    nop                                     ;[1117]
    nop                                     ;[1118]
    nop                                     ;[1119]
    nop                                     ;[111a]
    nop                                     ;[111b]
    nop                                     ;[111c]
    nop                                     ;[111d]
    nop                                     ;[111e]
    nop                                     ;[111f]
    nop                                     ;[1120]
    nop                                     ;[1121]
    nop                                     ;[1122]
    nop                                     ;[1123]
    nop                                     ;[1124]
    nop                                     ;[1125]
    nop                                     ;[1126]
    nop                                     ;[1127]
    nop                                     ;[1128]
    nop                                     ;[1129]
    nop                                     ;[112a]
    nop                                     ;[112b]
    nop                                     ;[112c]
    nop                                     ;[112d]
    nop                                     ;[112e]
    nop                                     ;[112f]
    nop                                     ;[1130]
    nop                                     ;[1131]
    nop                                     ;[1132]
    nop                                     ;[1133]
    nop                                     ;[1134]
    nop                                     ;[1135]
    nop                                     ;[1136]
    nop                                     ;[1137]
    nop                                     ;[1138]
    nop                                     ;[1139]
    nop                                     ;[113a]
    nop                                     ;[113b]
    nop                                     ;[113c]
    nop                                     ;[113d]
    nop                                     ;[113e]
    nop                                     ;[113f]
    nop                                     ;[1140]
    nop                                     ;[1141]
    nop                                     ;[1142]
    nop                                     ;[1143]
    nop                                     ;[1144]
    nop                                     ;[1145]
    nop                                     ;[1146]
    nop                                     ;[1147]
    nop                                     ;[1148]
    nop                                     ;[1149]
    nop                                     ;[114a]
    nop                                     ;[114b]
    nop                                     ;[114c]
    nop                                     ;[114d]
    nop                                     ;[114e]
    nop                                     ;[114f]
    nop                                     ;[1150]
    nop                                     ;[1151]
    nop                                     ;[1152]
    nop                                     ;[1153]
    nop                                     ;[1154]
    nop                                     ;[1155]
    nop                                     ;[1156]
    nop                                     ;[1157]
    nop                                     ;[1158]
    nop                                     ;[1159]
    nop                                     ;[115a]
    nop                                     ;[115b]
    nop                                     ;[115c]
    nop                                     ;[115d]
    nop                                     ;[115e]
    nop                                     ;[115f]
    nop                                     ;[1160]
    nop                                     ;[1161]
    nop                                     ;[1162]
    nop                                     ;[1163]
    nop                                     ;[1164]
    nop                                     ;[1165]
    nop                                     ;[1166]
    nop                                     ;[1167]
    nop                                     ;[1168]
    nop                                     ;[1169]
    nop                                     ;[116a]
    nop                                     ;[116b]
    nop                                     ;[116c]
    nop                                     ;[116d]
    nop                                     ;[116e]
    nop                                     ;[116f]
    nop                                     ;[1170]
    nop                                     ;[1171]
    nop                                     ;[1172]
    nop                                     ;[1173]
    nop                                     ;[1174]
    nop                                     ;[1175]
    nop                                     ;[1176]
    nop                                     ;[1177]
    nop                                     ;[1178]
    nop                                     ;[1179]
    nop                                     ;[117a]
    nop                                     ;[117b]
    nop                                     ;[117c]
    nop                                     ;[117d]
    nop                                     ;[117e]
    nop                                     ;[117f]
    nop                                     ;[1180]
    nop                                     ;[1181]
    nop                                     ;[1182]
    nop                                     ;[1183]
    nop                                     ;[1184]
    nop                                     ;[1185]
    nop                                     ;[1186]
    nop                                     ;[1187]
    nop                                     ;[1188]
    nop                                     ;[1189]
    nop                                     ;[118a]
    nop                                     ;[118b]
    nop                                     ;[118c]
    nop                                     ;[118d]
    nop                                     ;[118e]
    nop                                     ;[118f]
    nop                                     ;[1190]
    nop                                     ;[1191]
    nop                                     ;[1192]
    nop                                     ;[1193]
    nop                                     ;[1194]
    nop                                     ;[1195]
    nop                                     ;[1196]
    nop                                     ;[1197]
    nop                                     ;[1198]
    nop                                     ;[1199]
    nop                                     ;[119a]
    nop                                     ;[119b]
    nop                                     ;[119c]
    nop                                     ;[119d]
    nop                                     ;[119e]
    nop                                     ;[119f]
    nop                                     ;[11a0]
    nop                                     ;[11a1]
    nop                                     ;[11a2]
    nop                                     ;[11a3]
    nop                                     ;[11a4]
    nop                                     ;[11a5]
    nop                                     ;[11a6]
    nop                                     ;[11a7]
    nop                                     ;[11a8]
    nop                                     ;[11a9]
    nop                                     ;[11aa]
    nop                                     ;[11ab]
    nop                                     ;[11ac]
    nop                                     ;[11ad]
    nop                                     ;[11ae]
    nop                                     ;[11af]
    nop                                     ;[11b0]
    nop                                     ;[11b1]
    nop                                     ;[11b2]
    nop                                     ;[11b3]
    nop                                     ;[11b4]
    nop                                     ;[11b5]
    nop                                     ;[11b6]
    nop                                     ;[11b7]
    nop                                     ;[11b8]
    nop                                     ;[11b9]
    nop                                     ;[11ba]
    nop                                     ;[11bb]
    nop                                     ;[11bc]
    nop                                     ;[11bd]
    nop                                     ;[11be]
    nop                                     ;[11bf]
    nop                                     ;[11c0]
    nop                                     ;[11c1]
    nop                                     ;[11c2]
    nop                                     ;[11c3]
    ld      a,$01                           ;[11c4]
    ld      ($11fc),a                       ;[11c6]
    ret                                     ;[11c9]
    
    push    hl                              ;[11ca]
    ld      ($11fd),a                       ;[11cb]
    cp      $0f                             ;[11ce]
    call    c,$11c4                         ;[11d0]
    xor     a                               ;[11d3]
    ld      hl,$11fd                        ;[11d4]
    rrd                                     ;[11d7]
    and     $0f                             ;[11d9]
    add     $30                             ;[11db]
    cp      $3a                             ;[11dd]
    jp      m,$11e4                         ;[11df]
    add     $07                             ;[11e2]
    ld      ($11ff),a                       ;[11e4]
    ld      a,(hl)                          ;[11e7]
    add     $37                             ;[11e8]
    ld      ($11fe),a                       ;[11ea]
    ld      a,($11fc)                       ;[11ed]
    or      a                               ;[11f0]
    jr      z,$11fa                         ;[11f1]
    xor     a                               ;[11f3]
    ld      ($11fe),a                       ;[11f4]
    ld      ($11fc),a                       ;[11f7]
    pop     hl                              ;[11fa]
    ret                                     ;[11fb]
    
    nop                                     ;[11fc]
    nop                                     ;[11fd]
    nop                                     ;[11fe]
    nop                                     ;[11ff]
    inc     h                               ;[1200]
    push    hl                              ;[1201]
    ld      hl,$11fe                        ;[1202]
    ld      a,(hl)                          ;[1205]
    sub     $37                             ;[1206]
    rla                                     ;[1208]
    rla                                     ;[1209]
    rla                                     ;[120a]
    rla                                     ;[120b]
    ld      (hl),a                          ;[120c]
    inc     hl                              ;[120d]
    ld      a,(hl)                          ;[120e]
    sub     $30                             ;[120f]
    dec     hl                              ;[1211]
    add     (hl)                            ;[1212]
    ld      ($11fd),a                       ;[1213]
    pop     hl                              ;[1216]
    ret                                     ;[1217]
    
    nop                                     ;[1218]
    nop                                     ;[1219]
    nop                                     ;[121a]
    nop                                     ;[121b]
    nop                                     ;[121c]
    nop                                     ;[121d]
    nop                                     ;[121e]
    nop                                     ;[121f]
    nop                                     ;[1220]
    nop                                     ;[1221]
    nop                                     ;[1222]
    nop                                     ;[1223]
    nop                                     ;[1224]
    nop                                     ;[1225]
    nop                                     ;[1226]
    nop                                     ;[1227]
    nop                                     ;[1228]
    nop                                     ;[1229]
    nop                                     ;[122a]
    nop                                     ;[122b]
    nop                                     ;[122c]
    nop                                     ;[122d]
    nop                                     ;[122e]
    nop                                     ;[122f]
    nop                                     ;[1230]
    nop                                     ;[1231]
    nop                                     ;[1232]
    nop                                     ;[1233]
    nop                                     ;[1234]
    nop                                     ;[1235]
    nop                                     ;[1236]
    nop                                     ;[1237]
    nop                                     ;[1238]
    nop                                     ;[1239]
    nop                                     ;[123a]
    nop                                     ;[123b]
    nop                                     ;[123c]
    nop                                     ;[123d]
    nop                                     ;[123e]
    nop                                     ;[123f]
    nop                                     ;[1240]
    nop                                     ;[1241]
    nop                                     ;[1242]
    nop                                     ;[1243]
    ld      a,$01                           ;[1244]
    ld      ($11fc),a                       ;[1246]
    ret                                     ;[1249]
    
    push    hl                              ;[124a]
    ld      ($11fd),a                       ;[124b]
    cp      $0f                             ;[124e]
    call    c,$11c4                         ;[1250]
    xor     a                               ;[1253]
    ld      hl,$11fd                        ;[1254]
    rrd                                     ;[1257]
    and     $0f                             ;[1259]
    add     $30                             ;[125b]
    cp      $3a                             ;[125d]
    jp      m,$11e4                         ;[125f]
    add     $07                             ;[1262]
    ld      ($11ff),a                       ;[1264]
    ld      a,(hl)                          ;[1267]
    add     $37                             ;[1268]
    ld      ($11fe),a                       ;[126a]
    ld      a,($11fc)                       ;[126d]
    or      a                               ;[1270]
    jr      z,$127a                         ;[1271]
    xor     a                               ;[1273]
    ld      ($11fe),a                       ;[1274]
    ld      ($11fc),a                       ;[1277]
    pop     hl                              ;[127a]
    ret                                     ;[127b]
    
    nop                                     ;[127c]
    nop                                     ;[127d]
    nop                                     ;[127e]
    nop                                     ;[127f]
